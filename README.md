# 🚀 프리코스 3주차 미션 - 로또

---

로또를 발행하고, 로또 당첨 결과를 반환하는 🎰 **로또 발매기** 🎰입니다.

![woowacourse](https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Ff71cbdcd-b763-41af-9bbb-42abdb18bd6a%2F8725996b-9c63-4691-927f-2989a2f47ca8%2Fcover-22x.png&blockId=8705deab-d8f2-476b-9892-98b37b020779&width=2400)

## 주요 기능

- **로또 구입**
  - 사용자로부터 금액을 입력받습니다.
  - 이때 로또는 한 장에 `1,000원`입니다.
- **로또 발행**
  - 사용자가 구매한 금액에 따라 로또를 발행합니다.
  - 로또는 `중복되지 않는 1에서 45사이의 숫자 6개`를 의미합니다. 
- **로또 당첨 번호 입력**
  - 사용자로부터 당첨 번호를 입력받습니다.
  - 이때 당첨 번호는 `중복되지 않는 1에서 45 사이의 숫자 6개`를 의미합니다.
- **로또 보너스 번호 입력**
  - 사용자로부터 보너스 번호를 입력받습니다.
  - 이때 보너스 번호는 `당첨 번호와 중복되지 않는 1에서 45 사이의 숫자 1개`를 의미합니다.
- **로또 당첨 결과 및 통계 출력**
  - 로또와 당첨 번호의 일치 여부를 판단해 일치하는 수의 개수를 기준으로 로또 당첨 내역을 출력합니다.
  - 로또 당첨 내역에 따라 수익률를 계산해 출력합니다.

## 개발 환경

- Java 21
- IntelliJ IDEA 2024.1.4

## 채택한 디자인 패턴

- Factory 패턴 : 객체 생성 로직을 별도의 클래스로 분리하여 캡슐화하는 패턴
   - 정적 팩토리 패턴을 사용해 생성자를 캡슐화했습니다. 
- Strategy 패턴 : 객체의 행위를 동적으로 변경하고 싶을 때 직접 행위를 수정하지 않고 전략을 변경해 행위를 유연하게 확장하는 패턴
   - 로또 당첨 개수를 합산할 때 당첨 개수에 따라 각기 다른 값을 가지도록 구현했습니다.

## 프로젝트 구조

```
- controller
    |- BonusController : 보너스 번호 입력
    |- LottoController : 로또 구입 금액에 따른 로또 발행 및 출력 
    |- PaymentController : 로또 구입 금액 입력 
    |- ResultController : 로또 당첨 통계, 수익률 계산 및 출력
    |- WinningController : 당첨 번호 입력
- domain
    |- Bonus : 보너스 번호 값 검증 및 예외 처리
    |- Lotto : 로또 번호 값 검증 및 예외 처리
    |- Wallet : 로또 구입 금액 값 검증 및 예외 처리
- exception
    |- BonusExcpetion : 보너스 번호 예외
    |- LottoException : 로또 번호 예외
    |- MoneyException : 로또 구입 금액 예외
- factory
    |- BonusFactory : 보너스 객체 생성 
    |- LottoFactory : 로또 객체 생성
    |- WalletFactory : 지갑 객체 생성
- message
    |- ExceptionMessage : 예외 메시지 정의
    |- Place : 등수 정의
    |- PrintMessage : 출력 메시지 정의
    |- Prize : 등수 별 상금 정의
- service
    |- calculator
        |- ResultCalculator : 당첨 결과 합산 및 당첨 통계 계산
        |- WinningCalculator : 당첨 결과 계산 및 반환
        |- BonusCalculator : 보너스 당첨 결과 게산 및 반환
    |- generator
        |- BonusGenerator : 사용자로부터 입력받은 보너스 번호 검증 및 생성
        |- LottoGenerator : 로또 번호 생성 및 로또 티켓 발행
        |- WalletGenerator : 사용자로부터 입력받은 돈 검증 및 지갑 생성
        |- WinningGenerator : 사용자로부터 입력받은 당첨 번호 값 검증 및 로또 생성
    |- printer
        |- ResultPrinter : 당첨 결과 통계 결과 출력, 상금 계산
    |- Payment : 지갑 관련 로직 정의(돈, 구입 로또 개수)
- strategy
    |- PlaceAuction : 등수 별 동작 정의(interface)
    |- FirstPlace : 1등일 경우 동작 구현
    |- SecondPlace : 2등, 3등일 경우 동작 구현
    |- FourthPlace : 4등일 경우 동작 구현
    |- FifthPlace : 5등일 경우 동작 구현
- util
    |- ProfitCalculator : 수익률 계산
    |- NumberValidator : 수 검증 및 예외 처리(공통 로직)
- view
    |- Input : InputView의 interface
    |- InputView : 입력 정의
    |- Output : OutputView의 interface
    |- OutputView : 출력 정의
- Application : 로또 발행기 동작
```

<br>

## 💡 목차

---

- [시작하기](#-시작하기)
- [Commit convention](#-commit-convention)
- [Flow](#-flow)
    - [실행 결과 예시](#실행-결과-예시)
- [용어 정의](#-용어-정의)
- [구현 리스트](#-구현-리스트)
    - [기능 구현 리스트](#기능-구현-리스트)
    - [입출력 구현 리스트](#입출력-구현-리스트)
- [프로젝트 구현 후기](#프로젝트-구현-후기)

<br>

## 🚀 시작하기

---

레포지토리를 Clone한 뒤 IDE에서 어플리케이션을 실행합니다.

```
git clone https://github.com/woowacourse-precourse/java-calculator-7.git
```

브런치를 생성한 뒤 구현을 시작합니다.

```
git branch -b {branch name}
```

기능 구현 후 add, commit 명령을 사용해 로컬 저장소에 변경된 부분을 반영합니다.

```
git status // 변경된 파일 확인
git add -A(또는 .) // 변경된 전체 파일을 한번에 반영
git commit -m "message" // 작업한 내용을 메시지에 기록
```

모든 기능 구현을 마친 후, 원격 저장소에 commit을 반영하기 위해 branch를 push합니다.

```
git push origin {branch name}
```

<br>

## 📡 Commit Convention

```
<type> : <subject> 

<body> 

<footer>
```

```
git commit -m "<type> : <subject>" -m "" -m "<body>" -m "" -m "<footer>"
```

- ### Type
    - feat(feature) : 새로운 기능 추가
    - fix(bug fix) : 버그 수정
    - docs(documentation) : 문서 수정
    - style(formatting) : 코드 스타일 변경
    - refactor : 코드 리팩토링(기능 변경 X)
    - test(when adding missing tests) : 테스트 코드 추가, 수정
    - chore(maintain) : 빌드 관련 작업, 설정 수정
- ### Subject : 한 줄 요약
    - 명령형
    - 현재 시제 사용
    - 첫 글자 대문자 금지
    - 문장 끝에 마침표(.) 금지
- ### Message Body(선택 사항) : 변경 사항에 대한 상세 설명
    - 현재 시제 사용
    - 변경 이유 포함
    - 이전 동작과 대조
- ### Message footer(선택 사항)
    - Breaking changes
        - 변경 사항, 주의해야할 부분, 관련 이슈에 대한 설명과 함께 모든 변경 사항을 하단에 언급
    - Referencing issues
        - 이슈가 닫힌 경우(버그 해결) 사용
        - `Closed #keyword`
        - keyword : issue number

### Commit Message Example

```
feat: 사용자 로그인 기능 추가

사용자가 이메일과 비밀번호로 로그인할 수 있는 기능을 추가했습니다.
JWT 토큰을 사용하여 인증 절차를 구현하였으며, 로그인 실패 시의 오류 처리를 강화했습니다.

BREAKING CHANGE: 기존의 인증 방식이 JWT로 변경되었습니다.
Related to: #123
```

More : [Commit Message convention](https://gist.github.com/9941e89d80e2bc58a153.git)

<br>

## ⏳ Flow

---

1. `로또 구입 금액 문구를 출력`합니다. 
2. 사용자로부터 `로또 구입 금액을 입력`받습니다. 
3. 로또 구입 금액을 통해 `구입한 로또 개수를 계산`합니다. 
4. `구입한 로또의 개수를 출력`합니다. 
5. 로또 발행기가 구입한 로또의 개수만큼 `로또를 발행`합니다. 
6. `당첨 번호 입력 문구를 출력`합니다. 
7. 사용자로부터 `로또 당첨 번호를 입력`받습니다. 
8. `보너스 번호 입력 문구를 출력`합니다. 
9. `로또와 당첨 번호의 일치 여부를 판단`합니다. 
10. 사용자로부터 `보너스 번호를 입력`받습니다. 
11. `로또와 보너스 번호의 일치 여부를 판단`합니다. 
12. `당첨 통계 문구와 구분선을 출력`합니다. 
13. `당첨 통계 내역을 출력`합니다. 
14. 당첨 통계 내역을 기준으로 `수익률을 계산`합니다. 
15. `수익률을 출력`합니다. 
16. 로또 발매기를 `종료`합니다.

### 실행 결과 예시

```
구입금액을 입력해 주세요.
8000

8개를 구매했습니다.
[8, 21, 23, 41, 42, 43]
[3, 5, 11, 16, 32, 38]
[7, 11, 16, 35, 36, 44]
[1, 8, 11, 31, 41, 42]
[13, 14, 16, 38, 42, 45]
[7, 11, 30, 40, 42, 43]
[2, 13, 22, 32, 38, 45]
[1, 3, 5, 14, 22, 45]

당첨 번호를 입력해 주세요.
1,2,3,4,5,6

보너스 번호를 입력해 주세요.
7

당첨 통계
---
3개 일치 (5,000원) - 1개
4개 일치 (50,000원) - 0개
5개 일치 (1,500,000원) - 0개
5개 일치, 보너스 볼 일치 (30,000,000원) - 0개
6개 일치 (2,000,000,000원) - 0개
총 수익률은 62.5%입니다.
```

<br>

## 🏷️ 용어 정의

---

- `Lotto` : 발행한 로또 혹은 당첨 번호를 의미한다.
- `LottoTicket` : 구입 금액에 따라 발행한 로또들을 의미한다.
- `Winning` : 당첨 번호를 의미한다.
- `Bonus` : 보너스 번호를 의미한다.
- `Wallet` : 구입 금액을 가지는 지갑을 의미한다.
- `Factory` : 생성자를 외부에서 생성하는 역할을 수행한다.
- `Generator` : 입력에 대한 값을 생성하는 로직을 수행한다.
- `Calculator` : 입력에 대한 결과를 계산하는 로직을 수행한다.
- `PlaceAuction` : 등수에 따른 결과를 합산하기 위한 전략이다.

<br>

## 📃 구현 리스트

---

### 기능 구현 리스트

- 로또 구입
   - [x] `로또 구입 금액 / 1000`으로 구입할 로또의 개수를 계산한다. 
- 로또 발행
   - [x] 중복되지 않는 숫자 6개를 생성한다. `Randoms.pickUniqueNumbersInRange(1, 45, 6);`
   - [x] 발행한 로또를 오름차순 정렬한다.
   - [x] 로또 구입 개수만큼 로또를 발행한다.
- 로또 당첨 판단
   - [x] 사용자가 입력한 당첨 번호와 생성된 로또를 비교해 일치하는 번호의 수를 센다.
   - [x] 사용자가 입력한 보너스 번호와 생성된 로또를 비교해 일치하는 번호의 수를 센다.
   - [x] 일치하는 번호의 수 합산
      - [x] 6개가 일치할 경우 1등의 개수를 1 증가시킨다. 
      - [x] 5개가 일치할 경우, 보너스 번호가 일치하면 2등의 개수를 1 증가시킨다. 
      - [x] 5개가 일치할 경우, 보너스 번호가 일치하지 않으면 3등의 개수를 1 증가시킨다.
      - [x] 4개가 일치할 경우 4등의 개수를 1 증가시킨다. 
      - [x] 3개가 일치할 경우 5등의 개수를 1 증가시킨다. 
- 로또 당첨금 계산
   - [x] 1등 -- 6개가 일치할 경우 `2,000,000,000원`을 당첨금에 더한다.
   - [x] 2등 -- 5개와 보너스 번호가 일치할 경우 `30,000,000원`을 당첨금에 더한다.
   - [x] 3등 -- 5개가 일치할 경우 `1,500,000원`을 당첨금에 더한다.
   - [x] 4등 -- 4개가 일치할 경우 `50,000원`을 당첨금에 더한다.
   - [x] 5등 -- 3개가 일치할 경우 `5,000원`을 당첨금에 더한다.
- 로또 수익률 계산
   - [x] `로또 당첨금 / 로또 구입 금액 * 100`으로 로또 수익률을 계산한다.

- 예외 처리
   - [x] 예외 발생 시 `IllegalArgumentException`을 발생시킨다.
   - [x] 예외를 발생시킨 후 해당 값을 다시 입력받는다.

### 입출력 구현 리스트

- 입력
   - [x] 사용자로부터 로또 구입 금액을 입력 받는다.
      - [x] 입력된 금액이 정수가 아닐 경우 예외 처리 
      - [x] 1,000원 단위가 아닐 경우 예외 처리
      - [x] 주어진 자료형을 벗어나는 금액일 경우 예외 처리
   - [x] 사용자로부터 당첨 번호를 입력 받는다.
      - [x] 쉼표를 포함하지 않을 경우 예외 처리
      - [x] 중복된 번호가 있을 경우 예외 처리
      - [x] 번호가 6개가 아닐 경우 예외 처리
          - 당첨 번호
            - [x] 입력된 수가 정수가 아닐 경우(자료형을 벗어날 경우) 예외 처리 
            - [x] 1에서 45 사이의 수가 아닐 경우 예외 처리
   - [x] 사용자로부터 보너스 번호를 입력 받는다.
      - [x] 입력된 수가 정수가 아닐 경우(자료형을 벗어날 경우) 예외 처리
      - [x] 당첨 번호와 중복될 경우 예외 처리
      - [x] 1에서 45 사이의 수가 아닐 경우 예외 처리

- 출력
   - [x] 로또 구입 금액 문구를 출력한다. `구입금액을 입력해 주세요.`
   - [x] 구입한 로또 개수를 출력한다. `n개를 구매했습니다.`
   - [x] 구입한 로또 내역을 출력한다. `[1, 2, 3, 4, 5, 6]`
      - [x] 오름차순으로 정렬해 출력한다.  
   - [x] 당첨 번호 입력 문구를 출력한다. `당첨 번호를 입력해 주세요.`
   - [x] 보너스 번호 입력 문구를 출력한다. `보너스 번호를 입력해 주세요.`
   - [x] 당첨 통계 안내 문구를 출력한다. 
        ```
        당첨 통계
        ---
        ```
   - [x] 당첨 통계를 출력한다.
        ```
     3개 일치 (5,000원) - n개
     4개 일치 (50,000원) - n개
     5개 일치 (1,500,000원) - n개
     5개 일치, 보너스 볼 일치 (30,000,000원) - n개
     6개 일치 (2,000,000,000원) - n개
     ```
   - [x] 총 수익률을 출력한다. `총 수익률은 n.m%입니다.`
      - [x] 소수점 둘째 자리에서 반올림한다. 
   - [x] 예외 처리 시 `[ERROR]` 문구로 시작하도록 출력한다.

## 프로젝트 구현 후기

- 이번 미션을 통해 `정적 팩토리 패턴`을 사용해 외부에서 `new` 키워드를 사용하지 않고 객체를 생성하도록 했습니다. 
  - 하지만 테스트를 위해 생성자를 `public`으로 설정했고, 이는 추후 보완해야할 사항으로 보입니다. 
  - 이와 관련해서 지적할 사항이 있다면 지적해주세요. 🍀
- `enumMap`을 활용해 `enum`을 키 값으로 활용해 등수 계산에 사용하였습니다. 
  - `Map`이 아닌 `enumMap`을 사용해 데이터 관리를 더 효율적으로 하도록 구현했습니다. 
- 전략 패턴을 사용해 등수에 따라 다른 동작(`PlaceAuction`)을 하도록 구현했습니다.
- 시간 분배의 중요성을 깨닫게 되었습니다.
  - 이전 미션을 진행한 방식대로 `구현 전 계획 -> 공부 -> 구현 -> 테스트` 순으로 진행하니 테스트 코드에 시간을 들이지 못해 시간이 부족하다고 느꼈습니다.
  - 다음 미션을 진행할 때는 `구현 전 계획 -> 구현 + 공부 -> 테스트` 순으로 진행해 태스트 코드를 작성하는 시간을 늘리고 싶습니다. 